<app-inventory-topbar
  [(inventory)]="items"
  [(searchTerm)]="searchTerm"
></app-inventory-topbar>
<div class="item-inventory" *ngIf="items">
  @for (box of boxes; track box.id; let index = $index) {
    <div class="box-wrapper">
      <ng-template #contextOptions>
        @if (contextMenuTemplate == 'default') {
          <app-context-menu-inventory-options
            *ngIf="showContextualMenu"
            (clickEquip)="
              onDoubleClick.emit(filteredItems[index]);
              contextMenuService.hideContextMenu()
            "
            (clickDestroy)="
              onDestroyItem.emit(filteredItems[index]);
              contextMenuService.hideContextMenu()
            "
          >
          </app-context-menu-inventory-options>
        } @else {
          <app-blacksmith-context-menu
            *ngIf="showContextualMenu"
            (anvilIt)="
              onDoubleClick.emit(filteredItems[index]);
              contextMenuService.hideContextMenu()
            "
          >
          </app-blacksmith-context-menu>
        }
      </ng-template>
      <app-item-box
        (contextmenu)="contextMenuService.onContextMenu($event, contextOptions)"
        (click)="addToSelectedItems(filteredItems[index])"
        (mouseover)="onHover.emit(filteredItems[index])"
        (mouseout)="onHover.emit(null)"
        (dndStart)="
          onDragStart.emit({ event: $event, data: filteredItems[index] })
        "
        (dndEnd)="onDragEnd.emit($event)"
        (appDoubleClick)="onDoubleClick.emit(filteredItems[index])"
        [dndDraggable]="filteredItems[index]"
        [dndEffectAllowed]="'all'"
        [dndDisableIf]="!filteredItems[index] || disableDND"
        [height]="boxSize"
        [width]="boxSize"
        [rarity]="filteredItems[index]?.itemData?.rarity"
        [active]="isMultipleSelected(filteredItems[index])"
        [displayTooltip]="!!filteredItems[index]"
        [image]="
          filteredItems[index]?.itemData?.imageLocal
            ? (filteredItems[index]?.itemData?.imageLocal)
            : null
        "
      >
        @if (!!filteredItems[index] && !contextMenuService.menuVisible()) {
          <div tooltip class="tooltip-uruk">
            <app-item-tooltip
              [item]="filteredItems[index]"
              [compareWith]="equippedItemOfType"
            ></app-item-tooltip>
            <app-item-tooltip
              *ngIf="equippedItemOfType && getShowItemCompare()"
              [item]="equippedItemOfType"
              [isBeingCompared]="true"
            ></app-item-tooltip>
          </div>
        }
      </app-item-box>
    </div>
  }

  <ng-content select="[extraItemBoxes]"></ng-content>
</div>
